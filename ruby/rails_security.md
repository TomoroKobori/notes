# セキュリティ
## セッションハイジャック
- 攻撃者がユーザのセッションIDを奪って、ユーザになりすますこと
- ログインされたユーザ情報はセッションに保存される
- セッションはcookie内にあるセッションIDで識別される
### 手法
- 無線LANからネットワークに侵入し、cookieを除く
  * `config.force_ssl = true` でSSL化することで対策
- クロスサイトスクリプティング(XSS)攻撃によってユーザのcookieを手に入れる
- セッション固定攻撃によって、ユーザのセッションIDを攻撃者が知っている値に固定する
## セッションストレージ
- RailsのCookieStoreはクライアント側のcookieにセッションハッシュを保存する
  * セッションIDの代わりにセッションハッシュをcookieから取得する
- CookieStoreはセッションデータの保管場所を暗号化しており、secret_key_base から暗号化キーを導出する
  * secrete_key_baseはtest環境とdevelop環境ではアプリ名から導出されており、その他環境ではcredentialsにランダムな文字列を定義する
  * 秘密鍵が漏洩した場合は、secret_key_baseを変更すると現在の保持されているセッションが全て期限切れになる
  * セッションハッシュ == 暗号化されたsecret_key_base??
## セッション固定攻撃
- ユーザのセッションIDを攻撃者が知っている値に固定し、ユーザが気づかない間に強制的にセッションIDを使わせる
### 手法
1. 攻撃者はwebアプリケーションにログインしてcookieからセッションIDを取得する
2. 取得したセッションIDを標的ユーザに強制的に読み込ませる
  * cookieは外部ドメインから変更することができない
  * XSSによってwebアプリケーション内にjavascriptを仕込み、ユーザのセッションIDを強制的に書き換える
    * `<script>document.cookie="_session_id=セッションID";</script>`
3. その後標的ユーザがログインすると、攻撃者と標的ユーザはセッションを共有した状態になる
  * 標的ユーザは気づくことができない